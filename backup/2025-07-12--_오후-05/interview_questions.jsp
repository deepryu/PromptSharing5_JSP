<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïù∏ÌÑ∞Î∑∞ ÏßàÎ¨∏ Í¥ÄÎ¶¨ - Ï±ÑÏö© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú V1.0</title>
    <base href="${pageContext.request.contextPath}/">
    <link rel="stylesheet" href="css/common.css">
    <style>
        /* Ïù∏ÌÑ∞Î∑∞ ÏßàÎ¨∏ ÌéòÏù¥ÏßÄ Ï†ÑÏö© Ïä§ÌÉÄÏùº */
        
        /* ÏßàÎ¨∏ Î™©Î°ù ÌÖåÏù¥Î∏î Ïä§ÌÉÄÏùº */
        .question-table {
            background: white;
            border: 1px solid #d0d7de;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .table-header {
            background: #f6f8fa;
            border-bottom: 1px solid #d0d7de;
            padding: 12px 20px;
            font-weight: 600;
            color: #24292f;
            font-size: 0.9rem;
        }
        
        .question-item {
            padding: 15px 20px;
            border-bottom: 1px solid #d0d7de;
            transition: background-color 0.2s;
        }
        
        .question-item:last-child {
            border-bottom: none;
        }
        
        .question-item:hover {
            background: #f6f8fa;
        }
        
        .question-content {
            display: grid;
            grid-template-columns: 1fr auto auto auto auto;
            gap: 15px;
            align-items: center;
        }
        
        .question-text {
            font-weight: 500;
            color: #24292f;
            font-size: 0.95rem;
        }
        
        .question-meta {
            font-size: 0.8rem;
            color: #656d76;
            margin-top: 5px;
        }
        
        .category-badge {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid;
        }
        
        .category-tech { 
            background: #dbeafe; 
            color: #1e40af; 
            border-color: #93c5fd; 
        }
        
        .category-personality { 
            background: #f3e8ff; 
            color: #7c3aed; 
            border-color: #c4b5fd; 
        }
        
        .category-experience { 
            background: #dcfce7; 
            color: #16a34a; 
            border-color: #86efac; 
        }
        
        .category-situation { 
            background: #fed7aa; 
            color: #ea580c; 
            border-color: #fdba74; 
        }
        
        .category-default { 
            background: #f6f8fa; 
            color: #656d76; 
            border-color: #d0d7de; 
        }
        
        .difficulty-stars {
            color: #fb8500;
            font-size: 1em;
        }
        
        .status-badge {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid;
        }
        
        .status-active { 
            background: #dcfce7; 
            color: #16a34a; 
            border-color: #86efac; 
        }
        
        .status-inactive { 
            background: #fee2e2; 
            color: #dc2626; 
            border-color: #fca5a5; 
        }
        
        .action-buttons {
            display: flex;
            gap: 4px;
        }
        
        .btn-icon {
            width: 28px;
            height: 28px;
            border-radius: 3px;
            border: 1px solid #d0d7de;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s;
            background: white;
        }
        
        .btn-view { 
            color: #0969da; 
            border-color: #0969da; 
        }
        
        .btn-edit { 
            color: #1a7f37; 
            border-color: #1a7f37; 
        }
        
        .btn-delete { 
            color: #cf222e; 
            border-color: #cf222e; 
        }
        
        .btn-toggle { 
            color: #9a6700; 
            border-color: #9a6700; 
        }
        
        .btn-icon:hover {
            background: #f6f8fa;
            transform: scale(1.05);
        }
        
        .no-questions {
            text-align: center;
            padding: 60px 20px;
            color: #656d76;
        }
        
        .no-questions h3 {
            color: #24292f;
            margin-bottom: 10px;
        }
        
        .search-highlight {
            background: #fff8c4;
            padding: 1px 3px;
            border-radius: 2px;
        }
        
        .btn {
            padding: 6px 12px;
            border: 1px solid #d0d7de;
            border-radius: 3px;
            background: white;
            color: #24292f;
            cursor: pointer;
            font-size: 0.85rem;
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #f6f8fa;
            border-color: #8c959f;
        }
        
        .btn-primary {
            background: #2da44e;
            color: white;
            border-color: #2da44e;
        }
        
        .btn-primary:hover {
            background: #2c974b;
            border-color: #2c974b;
        }
        
        .btn-secondary {
            background: #6e7681;
            color: white;
            border-color: #6e7681;
        }
        
        .btn-secondary:hover {
            background: #656d76;
            border-color: #656d76;
        }
        
        .btn-light {
            background: #f6f8fa;
            color: #24292f;
            border-color: #d0d7de;
        }
        
        .btn-light:hover {
            background: #f3f4f6;
            border-color: #8c959f;
        }
        
        .alert {
            padding: 12px 16px;
            margin: 10px 0;
            border-radius: 3px;
            border: 1px solid;
        }
        
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-color: #93c5fd;
        }
        
        .alert-success {
            background: #dcfce7;
            color: #16a34a;
            border-color: #86efac;
        }
        
        .alert-danger {
            background: #fee2e2;
            color: #dc2626;
            border-color: #fca5a5;
        }
        
        input[type="text"], select {
            padding: 6px 8px;
            border: 1px solid #d0d7de;
            border-radius: 3px;
            font-size: 0.85rem;
            background: white;
        }
        
        /* ÏßàÎ¨∏ Ïπ¥ÌÖåÍ≥†Î¶¨ Î∞∞ÏßÄ Î∞è ÎÇúÏù¥ÎèÑ Ïä§ÌÉÄÏùº */
        .category-badge {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: 500;
            text-align: center;
            display: inline-block;
            white-space: nowrap;
        }
        
        .difficulty-stars {
            color: #f59e0b;
            font-size: 0.9rem;
        }
        
        /* Ïï°ÏÖò Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .action-buttons {
            display: flex;
            gap: 4px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn-icon {
            padding: 4px 8px;
            border: 1px solid #d0d7de;
            border-radius: 3px;
            background: white;
            cursor: pointer;
            font-size: 0.8rem;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .btn-icon:hover {
            background: #f6f8fa;
        }
        
        .btn-view { color: #0969da; }
        .btn-edit { color: #7c3aed; }
        .btn-toggle { color: #0d9488; }
        .btn-delete { color: #dc2626; }
        
        /* ÏßàÎ¨∏Ïù¥ ÏóÜÏùÑ Îïå ÌëúÏãú */
        .no-questions {
            text-align: center;
            padding: 40px 20px;
            color: #656d76;
        }
        
        .no-questions h3 {
            margin: 0 0 10px 0;
            color: #24292f;
        }
        
        /* ÌÅ¥Î¶≠ Í∞ÄÎä•Ìïú ÌÜµÍ≥Ñ Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .stat-item.clickable {
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .stat-item.clickable:hover {
            background: #e6f3ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: #bfdbfe;
        }
        
        .stat-item.clickable.active {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 2px solid #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 
                        0 4px 12px rgba(59, 130, 246, 0.3);
            transform: translateY(-1px);
        }
        
        .stat-item.clickable.active .stat-number {
            color: #1d4ed8;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(29, 78, 216, 0.1);
        }
        
        .stat-item.clickable.active .stat-label {
            color: #1e40af;
            font-weight: 600;
        }
        
        .stat-item.clickable::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            border-radius: 6px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s;
        }
        
        .stat-item.clickable.active::before {
            opacity: 0.1;
        }
        
        .stat-item.clickable::after {
            content: 'üëÜ';
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 0.7rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .stat-item.clickable:hover::after {
            opacity: 0.7;
        }
        
        .stat-item.clickable.active::after {
            content: '‚úì';
            opacity: 1;
            color: #1d4ed8;
            font-weight: bold;
            font-size: 0.8rem;
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- Ìó§Îçî Î∞î -->
        <div class="top-bar">
            <h2>üìä Ï±ÑÏö© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</h2>
            <div class="nav-buttons">
                <a href="main.jsp" class="btn">üè† Î©îÏù∏</a>
                <a href="candidates" class="btn">üë• Ïù∏ÌÑ∞Î∑∞ ÎåÄÏÉÅÏûê Í¥ÄÎ¶¨</a>
                <a href="interview/list" class="btn">üìÖ Ïù∏ÌÑ∞Î∑∞ ÏùºÏ†ï Í¥ÄÎ¶¨</a>
                <a href="results" class="btn">üìù Ïù∏ÌÑ∞Î∑∞ Í≤∞Í≥º Í∏∞Î°ù/Í¥ÄÎ¶¨</a>
                <a href="statistics" class="btn">üìä ÌÜµÍ≥Ñ Î∞è Î¶¨Ìè¨Ìä∏</a>
                <a href="logout" class="btn btn-danger">üö™ Î°úÍ∑∏ÏïÑÏõÉ</a>
            </div>
        </div>
        
        <div class="main-content">
            <div class="content-header">
                <h1 style="text-align: center;">üí° Ïù∏ÌÑ∞Î∑∞ ÏßàÎ¨∏ Í¥ÄÎ¶¨</h1>
            </div>
            <div class="content-body">
                <!-- ÌÜµÍ≥Ñ Î∞î -->
                <div class="stats-bar">
                    <div class="stat-item clickable ${filterCategory == null || filterCategory == 'all' ? 'active' : ''}" 
                         onclick="filterByCategory('all')" 
                         title="Ï†ÑÏ≤¥ ÏßàÎ¨∏ Î≥¥Í∏∞">
                        <div class="stat-number">${totalQuestions}</div>
                        <div class="stat-label">Ï¥ù ÏßàÎ¨∏</div>
                    </div>
                    <c:forEach var="entry" items="${categoryStatistics}">
                        <div class="stat-item clickable ${filterCategory == entry.key ? 'active' : ''}" 
                             onclick="filterByCategory('${entry.key}')" 
                             title="${entry.key} Ïπ¥ÌÖåÍ≥†Î¶¨ ÏßàÎ¨∏Îßå Î≥¥Í∏∞">
                            <div class="stat-number">${entry.value}</div>
                            <div class="stat-label">
                                <c:choose>
                                    <c:when test="${entry.key == 'Í∏∞Ïà†'}">üíª Í∏∞Ïà†</c:when>
                                    <c:when test="${entry.key == 'Í∏∞Ïà†-Java-Ï¥àÍ∏â'}">‚òï Java Ï¥àÍ∏â</c:when>
                                    <c:when test="${entry.key == 'Í∏∞Ïà†-Java-Ï§ëÍ∏â'}">‚òï Java Ï§ëÍ∏â</c:when>
                                    <c:when test="${entry.key == 'Í∏∞Ïà†-Java-Í≥†Í∏â'}">‚òï Java Í≥†Í∏â</c:when>
                                    <c:when test="${entry.key == 'Í∏∞Ïà†-Python-Ï¥àÍ∏â'}">üêç Python Ï¥àÍ∏â</c:when>
                                    <c:when test="${entry.key == 'Í∏∞Ïà†-Python-Ï§ëÍ∏â'}">üêç Python Ï§ëÍ∏â</c:when>
                                    <c:when test="${entry.key == 'Í∏∞Ïà†-Python-Í≥†Í∏â'}">üêç Python Í≥†Í∏â</c:when>
                                    <c:when test="${entry.key == 'Ïù∏ÏÑ±'}">üë§ Ïù∏ÏÑ±</c:when>
                                    <c:when test="${entry.key == 'Í≤ΩÌóò'}">üìö Í≤ΩÌóò</c:when>
                                    <c:when test="${entry.key == 'ÏÉÅÌô©'}">üéØ ÏÉÅÌô©</c:when>
                                    <c:otherwise>${entry.key}</c:otherwise>
                                </c:choose>
                            </div>
                        </div>
                    </c:forEach>
                </div>

                <!-- Ïª®Ìä∏Î°§ ÏÑπÏÖò -->
                <div class="controls-section">
                    <div class="controls-grid">
                        <div class="search-container">
                            <form action="questions" method="get" style="display: inline; margin: 0;">
                                <input type="hidden" name="action" value="search">
                                <input type="text" name="keyword" id="searchInput" placeholder="ÏßàÎ¨∏ ÎÇ¥Ïö©, ÏòàÏÉÅÎãµÎ≥Ä Í≤ÄÏÉâ..." value="${searchKeyword}">
                                <button type="submit" class="btn">üîç Í≤ÄÏÉâ</button>
                            </form>
                            <button type="button" class="btn" onclick="clearSearch()">üîÑ Ï¥àÍ∏∞Ìôî</button>
                        </div>
                        <div class="filter-controls">
                            <form id="filterForm" action="questions" method="get" style="display: inline; margin: 0;">
                                <input type="hidden" name="action" value="filter">
                                <input type="hidden" id="hiddenCategory" name="category" value="${filterCategory != null ? filterCategory : 'all'}">
                                <input type="hidden" id="hiddenDifficulty" name="difficulty" value="${filterDifficulty != null ? filterDifficulty : 'all'}">
                                
                                <select name="category" id="categorySelect" onchange="applyFilters()">
                                    <option value="all">Ï†ÑÏ≤¥ Ïπ¥ÌÖåÍ≥†Î¶¨</option>
                                    <c:forEach var="cat" items="${categories}">
                                        <option value="${cat}" ${filterCategory == cat ? 'selected' : ''}>${cat}</option>
                                    </c:forEach>
                                </select>
                                
                                <select name="difficulty" id="difficultySelect" onchange="applyFilters()">
                                    <option value="all">Ï†ÑÏ≤¥ ÎÇúÏù¥ÎèÑ</option>
                                    <option value="1" ${filterDifficulty == 1 ? 'selected' : ''}>‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ (1Îã®Í≥Ñ)</option>
                                    <option value="2" ${filterDifficulty == 2 ? 'selected' : ''}>‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ (2Îã®Í≥Ñ)</option>
                                    <option value="3" ${filterDifficulty == 3 ? 'selected' : ''}>‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ (3Îã®Í≥Ñ)</option>
                                    <option value="4" ${filterDifficulty == 4 ? 'selected' : ''}>‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4Îã®Í≥Ñ)</option>
                                    <option value="5" ${filterDifficulty == 5 ? 'selected' : ''}>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (5Îã®Í≥Ñ)</option>
                                </select>
                                
                                <button type="button" class="btn" onclick="clearAllFilters()">üîÑ ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî</button>
                            </form>
                        </div>
                        <a href="questions?action=new" class="btn btn-primary">‚ûï ÏÉà ÏßàÎ¨∏ Îì±Î°ù</a>
                    </div>
                </div>

        <!-- Í≤∞Í≥º Ï†ïÎ≥¥ -->
        <c:if test="${searchKeyword != null}">
            <div class="alert alert-info">
                '<strong>${searchKeyword}</strong>' Í≤ÄÏÉâ Í≤∞Í≥º: ${searchResultCount}Í∞ú
            </div>
        </c:if>
        
        <c:if test="${filterResultCount != null}">
            <div class="alert alert-info">
                ÌïÑÌÑ∞ Í≤∞Í≥º: ${filterResultCount}Í∞ú
            </div>
        </c:if>
        
        <c:if test="${randomQuestions == true}">
            <div class="alert alert-success">
                üé≤ ÎûúÎç§ ÏßàÎ¨∏ ${randomLimit}Í∞úÍ∞Ä Ï∂îÏ∂úÎêòÏóàÏäµÎãàÎã§
                <c:if test="${randomCategory != null}"> (Ïπ¥ÌÖåÍ≥†Î¶¨: ${randomCategory})</c:if>
                <c:if test="${randomDifficulty != null}"> (ÎÇúÏù¥ÎèÑ: ${randomDifficulty})</c:if>
            </div>
        </c:if>

        <!-- ÏßàÎ¨∏ Î™©Î°ù -->
        <div class="question-table">
            <div class="table-header">
                <div style="display: grid; grid-template-columns: 1fr auto auto auto auto; gap: 15px;">
                    <div>ÏßàÎ¨∏ ÎÇ¥Ïö©</div>
                    <div style="text-align: center;">Ïπ¥ÌÖåÍ≥†Î¶¨</div>
                    <div style="text-align: center;">ÎÇúÏù¥ÎèÑ</div>
                    <div style="text-align: center;">ÏÉÅÌÉú</div>
                    <div style="text-align: center;">ÏûëÏóÖ</div>
                </div>
            </div>
            
            <c:choose>
                <c:when test="${empty questions}">
                    <div class="no-questions">
                        <h3>üìù Îì±Î°ùÎêú ÏßàÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§</h3>
                        <p>ÏÉàÎ°úÏö¥ Ïù∏ÌÑ∞Î∑∞ ÏßàÎ¨∏ÏùÑ Îì±Î°ùÌï¥Î≥¥ÏÑ∏Ïöî!</p>
                        <button class="btn btn-primary" onclick="location.href='questions?action=new'">
                            ‚ûï Ï≤´ Î≤àÏß∏ ÏßàÎ¨∏ Îì±Î°ùÌïòÍ∏∞
                        </button>
                    </div>
                </c:when>
                <c:otherwise>
                    <c:forEach var="question" items="${questions}">
                        <div class="question-item">
                            <div class="question-content">
                                <div>
                                    <div class="question-text">${question.questionSummary}</div>
                                    <div class="question-meta">
                                        ÏÉùÏÑ±Ïùº: ${question.formattedCreatedAt}
                                        <c:if test="${not empty question.expectedAnswerSummary}">
                                            | ÏòàÏÉÅÎãµÎ≥Ä: ${question.expectedAnswerSummary}
                                        </c:if>
                                    </div>
                                </div>
                                
                                <div style="text-align: center;">
                                    <span class="category-badge ${question.categoryColorClass}">
                                        ${question.category}
                                    </span>
                                </div>
                                
                                <div style="text-align: center;">
                                    <span class="difficulty-stars" title="${question.difficultyText}">
                                        ${question.difficultyStars}
                                    </span>
                                </div>
                                
                                <div style="text-align: center;">
                                    <span class="status-badge ${question.activeStatusClass}">
                                        ${question.activeStatusText}
                                    </span>
                                </div>
                                
                                <div class="action-buttons">
                                    <button class="btn-icon btn-view" 
                                            onclick="location.href='questions?action=detail&id=${question.id}'"
                                            title="ÏÉÅÏÑ∏Î≥¥Í∏∞">üëÅ</button>
                                    <button class="btn-icon btn-edit" 
                                            onclick="location.href='questions?action=edit&id=${question.id}'"
                                            title="ÏàòÏ†ï">‚úè</button>
                                    <button class="btn-icon btn-toggle" 
                                            onclick="toggleQuestion(${question.id})"
                                            title="ÌôúÏÑ±Ìôî/ÎπÑÌôúÏÑ±Ìôî">üîÑ</button>
                                    <button class="btn-icon btn-delete" 
                                            onclick="deleteQuestion(${question.id})"
                                            title="ÏÇ≠Ï†ú">üóë</button>
                                </div>
                            </div>
                        </div>
                    </c:forEach>
                </c:otherwise>
            </c:choose>
        </div>
        
        <!-- Î©îÏãúÏßÄ ÌëúÏãú -->
        <c:if test="${not empty error}">
            <div class="alert alert-danger" style="margin-top: 20px;">
                ${error}
            </div>
        </c:if>
        
        <c:if test="${not empty success}">
            <div class="alert alert-success" style="margin-top: 20px;">
                ${success}
            </div>
        </c:if>
            </div>
        </div>
    </div>

    <script>
        function clearSearch() {
            location.href = 'questions';
        }
        
        function deleteQuestion(id) {
            if (confirm('Ï†ïÎßêÎ°ú Ïù¥ ÏßàÎ¨∏ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n(Ïã§Ï†úÎ°úÎäî ÎπÑÌôúÏÑ±ÌôîÎê©ÎãàÎã§)')) {
                location.href = 'questions?action=delete&id=' + id;
            }
        }
        
        function toggleQuestion(id) {
            if (confirm('Ïù¥ ÏßàÎ¨∏Ïùò ÌôúÏÑ±Ìôî ÏÉÅÌÉúÎ•º Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                location.href = 'questions?action=toggle&id=' + id;
            }
        }
        
        // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌïÑÌÑ∞ÎßÅ Ìï®Ïàò (Í∏∞Ï°¥ ÎÇúÏù¥ÎèÑ ÌïÑÌÑ∞ Ïú†ÏßÄ)
        function filterByCategory(category) {
            // ÏãúÍ∞ÅÏ†Å ÌîºÎìúÎ∞±ÏùÑ ÏúÑÌïú Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏
            updateActiveStatCard(category);
            
            // ÌòÑÏû¨ ÎÇúÏù¥ÎèÑ ÌïÑÌÑ∞ Í∞í Í∞ÄÏ†∏Ïò§Í∏∞
            const difficultySelect = document.getElementById('difficultySelect');
            const currentDifficulty = difficultySelect ? difficultySelect.value : 'all';
            
            // ÏÖÄÎ†âÌä∏ Î∞ïÏä§ ÎèôÍ∏∞Ìôî
            const categorySelect = document.getElementById('categorySelect');
            if (categorySelect) {
                categorySelect.value = category;
            }
            
            // Î≥µÌï© ÌïÑÌÑ∞ÎßÅ Ï†ÅÏö©
            applyComplexFilter(category, currentDifficulty);
        }
        
        // Î≥µÌï© ÌïÑÌÑ∞ÎßÅ Ï†ÅÏö© Ìï®Ïàò
        function applyComplexFilter(category, difficulty) {
            const params = new URLSearchParams();
            
            // Ï†ÑÏ≤¥Í∞Ä ÏïÑÎãå Í≤ΩÏö∞Îßå ÌååÎùºÎØ∏ÌÑ∞ Ï∂îÍ∞Ä
            if (category && category !== 'all') {
                params.set('category', category);
            }
            if (difficulty && difficulty !== 'all') {
                params.set('difficulty', difficulty);
            }
            
            // ÌïÑÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ filter Ïï°ÏÖò, ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ ÌéòÏù¥ÏßÄ
            if (params.toString()) {
                params.set('action', 'filter');
                location.href = 'questions?' + params.toString();
            } else {
                location.href = 'questions';
            }
        }
        
        // ÌïÑÌÑ∞ Ï†ÅÏö© Ìï®Ïàò (ÏÖÄÎ†âÌä∏ Î∞ïÏä§ Î≥ÄÍ≤Ω Ïãú)
        function applyFilters() {
            const categorySelect = document.getElementById('categorySelect');
            const difficultySelect = document.getElementById('difficultySelect');
            
            const category = categorySelect ? categorySelect.value : 'all';
            const difficulty = difficultySelect ? difficultySelect.value : 'all';
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            updateActiveStatCard(category);
            
            // Î≥µÌï© ÌïÑÌÑ∞ÎßÅ Ï†ÅÏö©
            applyComplexFilter(category, difficulty);
        }
        
        // Î™®Îì† ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
        function clearAllFilters() {
            // ÏÖÄÎ†âÌä∏ Î∞ïÏä§ Ï¥àÍ∏∞Ìôî
            const categorySelect = document.getElementById('categorySelect');
            const difficultySelect = document.getElementById('difficultySelect');
            
            if (categorySelect) categorySelect.value = 'all';
            if (difficultySelect) difficultySelect.value = 'all';
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäº ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            updateActiveStatCard('all');
            
            // Ï†ÑÏ≤¥ Î™©Î°ùÏúºÎ°ú Ïù¥Îèô
            location.href = 'questions';
        }
        
        // ÌôúÏÑ± ÏÉÅÌÉú Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏ (Ï¶âÏãú ÏãúÍ∞ÅÏ†Å ÌîºÎìúÎ∞±)
        function updateActiveStatCard(selectedCategory) {
            const statItems = document.querySelectorAll('.stat-item.clickable');
            statItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨ Ïπ¥Îìú ÌôúÏÑ±Ìôî
            statItems.forEach(item => {
                const onclick = item.getAttribute('onclick');
                if (onclick && onclick.includes("'" + selectedCategory + "'")) {
                    item.classList.add('active');
                }
            });
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌòÑÏû¨ ÌïÑÌÑ∞ ÏÉÅÌÉú Î∞òÏòÅ
        document.addEventListener('DOMContentLoaded', function() {
            const currentCategory = '${filterCategory}' || 'all';
            const currentDifficulty = '${filterDifficulty}' || 'all';
            
            updateActiveStatCard(currentCategory);
            
            // Î≥µÌï© ÌïÑÌÑ∞ Ï†ïÎ≥¥ ÌëúÏãú
            if ((currentCategory && currentCategory !== 'all') || (currentDifficulty && currentDifficulty !== 'all')) {
                showComplexFilterInfo(currentCategory, currentDifficulty);
            }
        });
        
        // Î≥µÌï© ÌïÑÌÑ∞ Ï†ïÎ≥¥ ÌëúÏãú Ìï®Ïàò
        function showComplexFilterInfo(category, difficulty) {
            const existingAlert = document.querySelector('.complex-filter-alert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            let filterText = '<strong>üîç ÌôúÏÑ± ÌïÑÌÑ∞:</strong> ';
            const filters = [];
            
            if (category && category !== 'all') {
                filters.push(`Ïπ¥ÌÖåÍ≥†Î¶¨: ${category}`);
            }
            if (difficulty && difficulty !== 'all') {
                const difficultyText = ['', '‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ (1Îã®Í≥Ñ)', '‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ (2Îã®Í≥Ñ)', '‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ (3Îã®Í≥Ñ)', '‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4Îã®Í≥Ñ)', '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (5Îã®Í≥Ñ)'][difficulty];
                filters.push(`ÎÇúÏù¥ÎèÑ: ${difficultyText}`);
            }
            
            filterText += filters.join(' + ');
            
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-info complex-filter-alert';
            alertDiv.innerHTML = `
                ${filterText}
                <button type="button" class="btn" onclick="clearAllFilters()" style="margin-left: 10px; padding: 2px 8px; font-size: 0.8rem;">
                    ‚ùå Î™®Îì† ÌïÑÌÑ∞ Ìï¥Ï†ú
                </button>
            `;
            
            const controlsSection = document.querySelector('.controls-section');
            controlsSection.parentNode.insertBefore(alertDiv, controlsSection.nextSibling);
        }
        
        // Î©îÏãúÏßÄ ÏûêÎèô Ïà®ÍπÄ (ÌïÑÌÑ∞ ÏïåÎ¶ºÏùÄ Ï†úÏô∏)
        setTimeout(function() {
            const alerts = document.querySelectorAll('.alert:not(.complex-filter-alert)');
            alerts.forEach(alert => {
                alert.style.opacity = '0';
                setTimeout(() => alert.style.display = 'none', 300);
            });
        }, 5000);

    </script>
</body>
</html>